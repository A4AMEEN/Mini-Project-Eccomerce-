<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sidebar Menu</title>
  <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/css/adminstyle.css">
</head>


<body>
  <nav>
    <div class="sidebar-top">
      <span class="shrink-btn">
        <i class='bx bx-chevron-left'></i>
      </span>
      <img src="./img/logo.png" class="logo" alt="">
      <h3 class="hide">Aqumex</h3>
    </div>

    <div class="search">
      <i class='bx bx-search'></i>
      <input type="text" class="hide" placeholder="Quick Search ...">
    </div>

    <div class="sidebar-links">
      <ul>
        <div class="active-tab"></div>
        <li class="tooltip-element" data-tooltip="0">
          <a href="users" class="active" data-active="0">
            <div class="icon">
              <i class='bx bx-tachometer'></i>
              <i class='bx bxs-tachometer'></i>
            </div>
            <span class="link hide">USERS</span>
          </a>
        </li>
        <li class="tooltip-element" data-tooltip="1">
          <a href="users" data-active="1">
            <div class="icon">
              <i class='bx bx-folder'></i>
              <i class='bx bxs-folder'></i>
            </div>
            <span class="link hide">USERS</span>
          </a>
        </li>
        <li class="tooltip-element" data-tooltip="2">
          <a href="product" data-active="2">
            <div class="icon">
              <i class='bx bx-message-square-detail'></i>
              <i class='bx bxs-message-square-detail'></i>
            </div>
            <span class="link hide">PRODUCTS</span>
          </a>
        </li>
        <li class="" data-tooltip="3">
          <a href="orders" data-active="3">
            <div class="icon">
              <i class='bx bx-bar-chart-square'></i>
              <i class='bx bxs-bar-chart-square'></i>
            </div>
            <span class="link hide">ORDERS</span>
          </a>
        </li>
        <div class="tooltip">
          <span class="show">Dashboard</span>
          <span>Projects</span>
          <span>Messages</span>
          <span>Analytics</span>
        </div>
      </ul>

      <h4 class="hide">Shortcuts</h4>

      <ul>
        <li class="tooltip-element" data-tooltip="0">
          <a href="adminCatagory" data-active="4">
            <div class="icon">
              <i class='bx bx-notepad'></i>
              <i class='bx bxs-notepad'></i>
            </div>
            <span class="link hide">Catagories</span>
          </a>
        </li>
        <li class="history" data-tooltip="1">
          <a href="history" data-active="5">
            <div class="icon">
              <i class='bx bx-help-circle'></i>
              <i class='bx bxs-help-circle'></i>
            </div>
            <span class="link hide">OrderHistory</span>
          </a>
        </li>
        <li class="tooltip-element" data-tooltip="2">
          <a href="#" data-active="6">
            <div class="icon">
              <i class='bx bx-cog'></i>
              <i class='bx bxs-cog'></i>
            </div>
            <span class="link hide">Settings</span>
          </a>
        </li>
        <div class="tooltip">
          <span class="show">Tasks</span>
          <span>Help</span>
          <span>Settings</span>
        </div>
      </ul>
    </div>

    <div class="sidebar-footer">
      <a href="#" class="account tooltip-element" data-tooltip="0">
        <i class='bx bx-user'></i>
      </a>
      <div class="admin-user tooltip-element" data-tooltip="1">
        <div class="admin-profile hide">
          <img src="./img/face-1.png" alt="">
          <div class="admin-info">
            <h3>John Doe</h3>
            <h5>Admin</h5>
          </div>
        </div>
        <a href="#" class="log-out">
          <i class='bx bx-log-out'></i>
        </a>
      </div>
      <div class="tooltip">
        <span class="show">John Doe</span>
        <span>Logout</span>
      </div>
    </div>
  </nav>


  <main>
    <div class="coupon-section">
        <button class="btn-success" onclick="toggleCouponForm()">Add Coupons Code</button>
    </div>
    <div class="coupon-form" style="display: none;">
      <button class="close-button" onclick="toggleCouponForm()">Close</button>
      <form method="post" action="addcoupon" onsubmit="return validateCouponForm()">
          <input type="text" id="code" name="coupon_code" placeholder="Coupon code">
          <input type="text" name="discription" id="discription" placeholder="Coupon Description">
          <input type="number" min="1" max="99" name="offer" id="offer" placeholder="Offer %">
          <input type="number" min="1" name="amount" id="amount" placeholder="Min Price">
          <span id="couponValidationMsg" style="color: red; display: none;">Coupon code must be 10 characters long and cannot be empty.</span>
          <span id="descriptionValidationMsg" style="color: red; display: none;">Description cannot be empty.</span>
          <span id="offerValidationMsg" style="color: red; display: none;">Offer must be a number between 1 and 99.</span>
          <button type="submit" class="add-coupon-button">Add Coupon</button>
      </form>
  </div>
  
  <script>
      function validateCouponForm() {
          const couponCodeInput = document.getElementById('code');
          const descriptionInput = document.getElementById('description');
          const offerInput = document.getElementById('offer');
          const couponCode = couponCodeInput.value.trim();
          const description = descriptionInput.value.trim();
          const offer = offerInput.value.trim();
          const couponValidationMsg = document.getElementById('couponValidationMsg');
          const descriptionValidationMsg = document.getElementById('descriptionValidationMsg');
          const offerValidationMsg = document.getElementById('offerValidationMsg');
  
          // Check coupon code validation
          if (couponCode === '' || couponCode.length !== 10) {
              couponValidationMsg.style.display = 'block';
              return false;
          }
          couponValidationMsg.style.display = 'none';
  
          // Check description validation
          if (description === '') {
              descriptionValidationMsg.style.display = 'block';
              return false;
          }
          descriptionValidationMsg.style.display = 'none';
  
          // Check offer validation
          if (offer === '' || isNaN(offer) || offer < 1 || offer > 99) {
              offerValidationMsg.style.display = 'block';
              return false;
          }
          offerValidationMsg.style.display = 'none';
  
          return true; // Allow form submission
      }
  </script>
  
    <div class="coupon-table">
      <h2>Added Coupons</h2>
      <p><%= error %></p>
      <table id="couponTable">
          <thead>
              <tr>
                  <th>Coupon Code</th>
                  <th>Discount</th>
                  <th>Min Price</th>
                  <th>Status</th>
                  <th>Action</th> <!-- New column for the delete button -->
                  <th>Rework</th>
              </tr>
          </thead>
          <tbody id="couponList">
              <% coupons.forEach(coupon => { %>
                  <tr>
                      <td><%= coupon.code %></td>
                      <td><%= coupon.offer %>% off</td>
                      <td><%= coupon.amount %>&#8377</td>
                      <td style="color: <%= coupon.active ? 'green' : 'red' %>">
                          <%= coupon.active ? 'Active' : 'Approved' %>
                      </td>
                      <td>
                        <form method="post" action="deleteCoupon"> <!-- Replace '/deleteCoupon' with your actual endpoint -->
                          <input type="hidden" name="couponId" value="<%= coupon.id %>"> <!-- Assuming 'coupon.id' represents the unique identifier for each coupon -->
                          <button type="submit">Delete</button>
                      </form>
                      </td>
                      <td>
                        <% if (coupon.active) { %>
                            <!-- If the coupon is active, display this -->
                            <p>Valid</p>
                        <% } else { %>
                            <!-- If the coupon is not active, display the form to rework -->
                            <form method="post" action="reCoupon"> <!-- Replace '/reCoupon' with your actual endpoint -->
                                <input type="hidden" name="couponId" value="<%= coupon.id %>">
                                <button type="submit">Rework</button>
                            </form>
                        <% } %>
                    </td>
                    
                  </tr>
              <% }); %>
          </tbody>
      </table>
  </div>
  
</main>
<script>
    // Function to fetch coupons and update the table
async function fetchCoupons() {
    try {
        const response = await fetch('/api/coupons'); // Endpoint to retrieve coupons data
        const coupons = await response.json();

        const couponList = document.getElementById('couponList');

        // Clear previous content
        couponList.innerHTML = '';

        coupons.forEach(coupon => {
            const row = document.createElement('tr');
            const codeCell = document.createElement('td');
            codeCell.textContent = coupon.code;
            row.appendChild(codeCell);

            const statusCell = document.createElement('td');
            statusCell.textContent = coupon.active ? 'Active' : 'Inactive';
            statusCell.style.color = coupon.active ? 'green' : 'red';
            row.appendChild(statusCell);

            couponList.appendChild(row);
        });
    } catch (error) {
        console.error('Error fetching coupons:', error);
    }
}

// Call fetchCoupons initially to load coupons when the page loads
fetchCoupons();

</script>
<style>
    


    /* Style for the main section */
    main {
        padding: 20px;
        border: 2px solid #333;
        border-radius: 10px;
        background-color: #f9f9f9;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin: 20px;
    };

    /* Style for the table */
    #couponTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    #couponTable th, #couponTable td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
    }

    /* Alternating row colors for better readability */
    #couponTable tbody tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    /* Style for the button */
    .btn-success {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
    }

    /* Additional styles as needed */
    /* ... */


    
    .coupon-section {
        float: left;
        margin-right: 20px;
    }
    .yellow-button {
        background-color: yellow;
        height: 10px;
        border-radius: 15px;
        /* Add any other styles for the button */
    }
    .close-button {
        background-color: #ccc;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        /* Add any other styles for the close button */
    }
    .add-coupon-button {
        background-color: #ccc;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
                
        /* Add professional styles for the "Add Coupon" button */
    }
</style>

<script>
    function toggleCouponForm() {
        const couponForm = document.querySelector('.coupon-form');
        couponForm.style.display = couponForm.style.display === 'none' ? 'block' : 'none';
    }
</script>


  <script src="app.js"></script>
</body>

</html>